
<!DOCTYPE html>


<html lang="en" data-content_root="../../../" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Combining COS Data from Multiple Lifetime Positions and Central Wavelengths &#8212; HST Notebooks</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../../../_static/styles/theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../../../_static/styles/bootstrap.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../../../_static/styles/pydata-sphinx-theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />

  
  <link href="../../../_static/vendor/fontawesome/6.5.2/css/all.min.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../../../_static/vendor/fontawesome/6.5.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../../_static/vendor/fontawesome/6.5.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../../_static/vendor/fontawesome/6.5.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css?v=03e43079" />
    <link rel="stylesheet" type="text/css" href="../../../_static/styles/sphinx-book-theme.css?v=eba8b062" />
    <link rel="stylesheet" type="text/css" href="../../../_static/togglebutton.css?v=13237357" />
    <link rel="stylesheet" type="text/css" href="../../../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../../../_static/mystnb.8ecb98da25f57f5357bf6f572d296f466b2cfe2517ffebfabe82451661e28f02.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/sphinx-thebe.css?v=4fa983c6" />
    <link rel="stylesheet" type="text/css" href="../../../_static/sphinx-design.min.css?v=95c83b7e" />
    <link rel="stylesheet" type="text/css" href="../../../_static/table.css?v=cd6c26fb" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b" />
<link rel="preload" as="script" href="../../../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b" />
  <script src="../../../_static/vendor/fontawesome/6.5.2/js/all.min.js?digest=dfe6caa3a7d634c4db9b"></script>

    <script src="../../../_static/documentation_options.js?v=9eb32ce0"></script>
    <script src="../../../_static/doctools.js?v=9a2dae69"></script>
    <script src="../../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../../../_static/copybutton.js?v=f281be69"></script>
    <script src="../../../_static/scripts/sphinx-book-theme.js?v=887ef09a"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../../../_static/togglebutton.js?v=4a39c7ea"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../../../_static/design-tabs.js?v=f930bc37"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script async="async" src="../../../_static/sphinx-thebe.js?v=c100c467"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'notebooks/HASP/COSLifetimePositions/COSLifetimePositions';</script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
    <link rel="next" title="Programmatic Replacements for NICMOS Units Conversion Form" href="../../NICMOS/nicmos_unit_conversion/nicmos_unit_conversion.html" />
    <link rel="prev" title="Wavelength Adjustments for Running the Hubble Advanced Spectral Products (HASP) Script" href="../WavelengthAdjustment/WavelengthAdjustment.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-primary-sidebar-checkbox"/>
  <label class="overlay overlay-primary" for="pst-primary-sidebar-checkbox"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-secondary-sidebar-checkbox"/>
  <label class="overlay overlay-secondary" for="pst-secondary-sidebar-checkbox"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../../../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  
    
  

<a class="navbar-brand logo" href="../../../index.html">
  
  
  
  
  
    
    
      
    
    
    <img src="../../../_static/stsci_logo2.png" class="logo__image only-light" alt="HST Notebooks - Home"/>
    <script>document.write(`<img src="../../../_static/stsci_logo2.png" class="logo__image only-dark" alt="HST Notebooks - Home"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item">

 <script>
 document.write(`
   <button class="btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../../../index.html">
                    STScI HST Notebook Repository HQ
                </a>
            </li>
        </ul>
        <p aria-level="2" class="caption" role="heading"><span class="caption-text">ACS</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../ACS/README.html">ACS Notebooks</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../ACS/acs_findsat_mrt/acs_findsat_mrt_example.html">Satellite trail detection in ACS/WFC data using acstools.findsat_mrt</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../ACS/acs_saturation_trails/acs_saturation_trails.html">ACS Linearity with Saturated Stars</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../ACS/acs_cte_forward_model/acs_cte_forward_model_example.html">Pixel-based ACS/WFC CTE Forward Model</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../ACS/acs_subarrays/acs_subarrays.html">ACS Image Reduction for Subarray Data</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../ACS/acs_sbc_dark_analysis/acs_sbc_dark_analysis.html">SBC Dark Analysis</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../ACS/acs_reduction/acs_reduction.html">ACS/WFC Image Reduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../ACS/acs_pixel_area_maps/acs_pixel_area_maps.html">ACS Pixel Area Maps</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../ACS/acs_polarization_tools/acs_polarization_tools.html">Using ACS Polarization Tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../ACS/acs_focus_diverse_epsfs/acs_focus_diverse_epsfs.html">Focus Diverse ePSFs for ACS/WFC</a></li>

<li class="toctree-l1"><a class="reference internal" href="../../ACS/acs_exception_report/exception_report_checks.html">HST Exception Report - Investigate your ACS Data</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../ACS/hst_orbits_ephem/hst_orbits_ephem.html">Getting HST Ephemeris and Related Data for an Observation</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">COS</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../COS/README.html">COS Notebooks</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../COS/Setup/Setup.html">Setting up your computer environment for working with COS data</a></li>





<li class="toctree-l1"><a class="reference internal" href="../../COS/DataDl/DataDl.html">Downloading COS Data</a></li>




<li class="toctree-l1"><a class="reference internal" href="../../COS/ViewData/ViewData.html">Viewing COS Data</a></li>





<li class="toctree-l1"><a class="reference internal" href="../../COS/AsnFile/AsnFile.html">Modifying or Creating an Association File</a></li>





<li class="toctree-l1"><a class="reference internal" href="../../COS/CalCOS/CalCOS.html">Running the COS Data Pipeline (<code class="docutils literal notranslate"><span class="pre">CalCOS</span></code>)</a></li>






<li class="toctree-l1"><a class="reference internal" href="../../COS/SplitTag/SplitTag.html">Splitting COS Exposures into sub-exposures with <code class="docutils literal notranslate"><span class="pre">splittag</span></code></a></li>







<li class="toctree-l1"><a class="reference internal" href="../../COS/DayNight/DayNight.html">Filtering out COS Data taken during the Day or Night</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../COS/LSF/LSF.html">Working with the COS Line Spread Function (LSF)</a></li>

<li class="toctree-l1"><a class="reference internal" href="../../COS/Extract/Extract.html">Editing the extraction boxes in a spectral extraction file (<code class="docutils literal notranslate"><span class="pre">XTRACTAB</span></code>)</a></li>







<li class="toctree-l1"><a class="reference internal" href="../../COS/ExceptionReport/ExceptionReport.html">What to do when you get an Exception Report for COS</a></li>







</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">DrizzlePac</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../DrizzlePac/README.html">DrizzlePac Notebooks</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../DrizzlePac/using_updated_astrometry_solutions/using_updated_astrometry_solutions.html">Improving Astrometry Using Alternate WCS Solutions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../DrizzlePac/align_to_catalogs/align_to_catalogs.html">Aligning HST images to an Absolute Reference Catalog</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../DrizzlePac/align_sparse_fields/align_sparse_fields.html">Aligning Deep Exposures of Sparse Fields</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../DrizzlePac/align_multiple_visits/align_multiple_visits.html">Optimizing Image Alignment for Multiple HST Visits</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../DrizzlePac/use_ds9_regions_in_tweakreg/use_ds9_regions_in_tweakreg.html">TWEAKREG Tips - Using DS9 Regions for Source Inclusion/Exclusion</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../DrizzlePac/optimize_image_sampling/optimize_image_sampling.html">Optimizing the Image Sampling</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../DrizzlePac/align_mosaics/align_mosaics.html">Aligning HST Mosaics</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../DrizzlePac/sky_matching/sky_matching.html">Sky Matching for HST Mosaics <a id="top"></a></a></li>
<li class="toctree-l1"><a class="reference internal" href="../../DrizzlePac/mask_satellite/mask_satellite.html">Satellite Trail Masking Techniques</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../DrizzlePac/drizzle_wfpc2/drizzle_wfpc2.html">Drizzling new WFPC2 FLT data products with chip-normalization   </a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">HASP</span></p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../Setup/Setup.html">Installing the Hubble Advanced Spectral Products Script</a></li>
<li class="toctree-l1"><a class="reference internal" href="../CoaddTutorial/CoaddTutorial.html">Inputting User Data using the Hubble Advanced Spectral Products Script</a></li>

<li class="toctree-l1"><a class="reference internal" href="../FluxScaleTutorial/FluxScaleTutorial.html">Scaling Flux while using the Hubble Advanced Spectral Products Script</a></li>

<li class="toctree-l1"><a class="reference internal" href="../DataDiagnostic/DataDiagnostics.html">HASP Data Diagnostic Notebook</a></li>




<li class="toctree-l1"><a class="reference internal" href="../WavelengthAdjustment/WavelengthAdjustment.html">Wavelength Adjustments for Running the Hubble Advanced Spectral Products (HASP) Script</a></li>

<li class="toctree-l1 current active"><a class="current reference internal" href="#">Combining COS Data from Multiple Lifetime Positions and Central Wavelengths</a></li>

</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">NICMOS</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../NICMOS/nicmos_unit_conversion/nicmos_unit_conversion.html">Programmatic Replacements for NICMOS Units Conversion Form</a></li>


</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">STIS</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../STIS/README.html">STIS Notebooks</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../STIS/cross-correlation/cross-correlation.html">Correcting for Missing Wavecals with Cross-Correlation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../STIS/custom_ccd_darks/custom_ccd_darks.html">Custom CCD Darks <a class="tocSkip"></a></a></li>
<li class="toctree-l1"><a class="reference internal" href="../../STIS/drizpac_notebook/STIS_DrizzlePac_Tutorial.html">STIS DrizzlePac Tutorial <a class="tocSkip"></a></a></li>
<li class="toctree-l1"><a class="reference internal" href="../../STIS/CoronagraphyViz/STIS_Coronagraphy_Visualization_v2.html">STIS Coronagraphy Visualization Tool (v2)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../STIS/calstis/calstis_2d_ccd.html">Calstis 2-D CCD Data Reduction <a class="tocSkip"></a></a></li>
<li class="toctree-l1"><a class="reference internal" href="../../STIS/target_acquisition/target_acquisition.html">Evaluating STIS Target Acquisitions <a class="tocSkip"></a></a></li>
<li class="toctree-l1"><a class="reference internal" href="../../STIS/view_data/view_data.html">Viewing STIS Data</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../STIS/extraction/1D_Extraction.html">1D Spectra Extraction <a class="tocSkip"></a></a></li>
<li class="toctree-l1"><a class="reference internal" href="../../STIS/low_count_uncertainties/Low_Count_Uncertainties.html">Low Count Uncertainties in STIS <a class="tocSkip"></a></a></li>
<li class="toctree-l1"><a class="reference internal" href="../../STIS/contrast_sensitivity/STIS_Coronagraphic_Observation_Feasibility.html">STIS Coronagraphic Observation Feasibility</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">WFC3</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../WFC3/README.html">WFC3 Notebooks</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../WFC3/general_tools.html">General Tools</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../../WFC3/image_displayer_analyzer/wfc3_image_displayer_analyzer.html">WFC3 Image Displayer &amp; Analyzer</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../WFC3/exception_report/wfc3_exception_report.html">Exception Report Checklist - WFC3</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../WFC3/calwf3_v1.0_cte/calwf3_with_v1.0_PCTE.html">Processing WFC3/UVIS Data with <code class="docutils literal notranslate"><span class="pre">calwf3</span></code> Using the v1.0 CTE-Correction</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../WFC3/persistence/wfc3_ir_persistence.html">Masking Persistence in WFC3/IR Images</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../WFC3/uvis_g280_transit/G280_Exoplanet_Transits.html">Analyzing WFC3/UVIS G280 Exoplanet Transit Observations</a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../WFC3/ir_tvb.html">WFC3/IR Time Variable Background (TVB)</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../../WFC3/ir_ima_visualization/IR_IMA_Visualization_with_an_Example_of_Time_Variable_Background.html">WFC3/IR IMA Visualization Tools with An Example of Time Variable Background</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../WFC3/calwf3_recalibration/calwf3_recal_tvb.html">Manual Recalibration with calwf3: Turning off the IR Linear Ramp Fit</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../WFC3/tvb_flattenramp/TVB_flattenramp_notebook.html">Correcting for Helium Line Emission Background in IR Exposures using the “Flatten-Ramp” Technique</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../WFC3/ir_scattered_light_calwf3_corrections/Correcting_for_Scattered_Light_in_IR_Exposures_Using_calwf3_to_Mask_Bad_Reads.html">Correcting for Scattered Light in WFC3/IR Exposures: Using <code class="docutils literal notranslate"><span class="pre">calwf3</span></code> to Mask Bad Reads</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../WFC3/ir_scattered_light_manual_corrections/Correcting_for_Scattered_Light_in_IR_Exposures_by_Manually_Subtracting_Bad_Reads.html">Correcting for Scattered Light in WFC3/IR Exposures: Manually Subtracting Bad Reads</a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../WFC3/photometry.html">Photometry</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../../WFC3/filter_transformations/filter_transformations.html">WFC3/UVIS Filter Transformations with stsynphot</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../WFC3/flux_conversion_tool/flux_conversion_tool.html">Flux Unit Conversions with synphot and stsynphot</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../WFC3/photometry_examples/phot_examples.html">Synthetic Photometry Examples for WFC3</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../WFC3/uvis_time_dependent_photometry/uvis_timedep_phot.html">WFC3/UVIS Time-dependent Photometry</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../WFC3/zeropoints/zeropoints.html">Calculating WFC3 Zeropoints with STSynphot</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../WFC3/uvis_pam_corrections/WFC3_UVIS_Pixel_Area_Map_Corrections_for_Subarrays.html">WFC3/UVIS Pixel Area Map Corrections for Subarrays</a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../WFC3/point_spread_function.html">Point Spread Function (PSF)</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../../WFC3/point_spread_function/hst_point_spread_function.html">HST WFC3 Point Spread Function Modeling   </a></li>
<li class="toctree-l2"><a class="reference internal" href="../../WFC3/mast_api_psf/download_psf_cutouts.html">Downloading WFC3 and WFPC2 PSF Cutouts from MAST</a></li>
</ul>
</details></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><button class="sidebar-toggle primary-toggle btn btn-sm" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</button></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-launch-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Launch interactive content">
    <i class="fas fa-rocket"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://colab.research.google.com/github/spacetelescope/hst_notebooks/blob/main/notebooks/HASP/COSLifetimePositions/COSLifetimePositions.ipynb" target="_blank"
   class="btn btn-sm dropdown-item"
   title="Launch on Colab"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  
    <img alt="Colab logo" src="../../../_static/images/logo_colab.png">
  </span>
<span class="btn__text-container">Colab</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="initThebeSBT()"
  class="btn btn-sm btn-launch-thebe dropdown-item"
  title="Launch Thebe"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-play"></i>
  </span>
<span class="btn__text-container">Live Code</span>
</button>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/spacetelescope/hst_notebooks" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/spacetelescope/hst_notebooks/issues/new?title=Issue%20on%20page%20%2Fnotebooks/HASP/COSLifetimePositions/COSLifetimePositions.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../../../_sources/notebooks/HASP/COSLifetimePositions/COSLifetimePositions.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="theme-switch fa-solid fa-sun fa-lg" data-mode="light"></i>
    <i class="theme-switch fa-solid fa-moon fa-lg" data-mode="dark"></i>
    <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"></i>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm pst-navbar-icon search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<button class="sidebar-toggle secondary-toggle btn btn-sm" title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</button>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Combining COS Data from Multiple Lifetime Positions and Central Wavelengths</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#">Combining COS Data from Multiple Lifetime Positions and Central Wavelengths</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#in-this-notebook-we-will-explore-the-implications-of-combining-cos-data-taken-at-different-lifetime-positions-and-central-wavelengths"><span style="font-weight:normal">In this notebook, we will explore the implications of combining COS data taken at different lifetime positions and central wavelengths.</span></a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#learning-goals">Learning Goals:</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#table-of-contents">Table of Contents</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#introduction">0. Introduction</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#imports">Imports</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#download-the-cos-line-spread-functions">1. Download the COS Line-Spread Functions</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#define-functions-for-later-use">2. Define Functions for Later Use</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#compare-lsfs-from-various-lifetime-positions-and-cenwaves">3. Compare LSFs from Various Lifetime Positions and CENWAVEs</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#lsfs-from-various-central-wavelenths">3.1 LSFs from Various Central Wavelenths</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#lsfs-from-various-lifetime-positions">3.2 LSFs from Various Lifetime Positions</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#techniques-for-combining-spectra-with-different-lsfs">4. Techniques for Combining Spectra with Different LSFs</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#retrieve-and-combine-the-spectra">4.1 Retrieve and Combine the Spectra</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#fit-each-combination-of-grating-lsf-and-cenwave-separately">4.2 Fit each combination of grating, LSF, and CENWAVE separately</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#convolve-the-lp1-spectrum-to-match-lp4">4.3 Convolve the LP1 Spectrum to Match LP4</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#construct-a-bespoke-lsf-for-this-spectral-combination">4.4 Construct a bespoke LSF for this spectral combination</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#congrats-on-completing-the-notebook">Congrats on completing the notebook!</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#there-are-more-tutorial-notebooks-in-this-notebooks-repo-check-them-out">There are more tutorial notebooks in this notebooks repo.  Check them out!</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#about-this-notebook">About this Notebook</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#citations">Citations</a></li>
</ul>
</li>
</ul>

            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <div style='background-color: #fff3cd; border: 1px solid #ffeaa7; border-radius: 4px; padding: 15px; margin: 10px 0; border-left: 4px solid #f39c12;'>
<h3 style='color: #856404; margin-top: 0;'>⚠️ EXECUTION WARNING</h3>
<p style='color: #856404; margin-bottom: 0;'><strong>This notebook may not execute properly in the current environment.</strong></p>
<p style='color: #856404; margin-bottom: 0;'>Some cells may have failed during automated testing. Please review the notebook content and test manually before use.</p>
<p style='color: #856404; margin-bottom: 0; font-size: 0.9em;'><em>Generated during CI/CD pipeline - some outputs may be incomplete or missing.</em></p>
</div>
<section class="tex2jax_ignore mathjax_ignore" id="combining-cos-data-from-multiple-lifetime-positions-and-central-wavelengths">
<h1>Combining COS Data from Multiple Lifetime Positions and Central Wavelengths<a class="headerlink" href="#combining-cos-data-from-multiple-lifetime-positions-and-central-wavelengths" title="Link to this heading">#</a></h1>
<section id="in-this-notebook-we-will-explore-the-implications-of-combining-cos-data-taken-at-different-lifetime-positions-and-central-wavelengths">
<h2><span style="font-weight:normal">In this notebook, we will explore the implications of combining COS data taken at different lifetime positions and central wavelengths.</span><a class="headerlink" href="#in-this-notebook-we-will-explore-the-implications-of-combining-cos-data-taken-at-different-lifetime-positions-and-central-wavelengths" title="Link to this heading">#</a></h2>
</section>
<section id="learning-goals">
<h2>Learning Goals:<a class="headerlink" href="#learning-goals" title="Link to this heading">#</a></h2>
<p>In this tutorial, you will learn</p>
<ul class="simple">
<li><p>How the COS line-spread functions (LSFs) vary with central wavelength and lifetime position</p></li>
<li><p>How to smooth one COS spectrum to the resolution of another – and the limits of this approach</p></li>
<li><p>How to construct a bespoke line-spread function appropriate for particular combination of spectra</p></li>
</ul>
</section>
<section id="table-of-contents">
<h2>Table of Contents<a class="headerlink" href="#table-of-contents" title="Link to this heading">#</a></h2>
<p><strong>0. <a class="reference internal" href="#introduction"><span class="xref myst">Introduction</span></a></strong></p>
<p><strong>1. <a class="reference internal" href="#lsfdownload"><span class="xref myst">Download the COS Line-Spread Functions</span></a></strong></p>
<p><strong>2. <a class="reference internal" href="#definitions"><span class="xref myst">Define Functions for Later Use</span></a></strong></p>
<p><strong>3. <a class="reference internal" href="#comparelsfs"><span class="xref myst">Compare LSFs from Various Lifetime Positions and CENWAVEs</span></a></strong></p>
<p>- 3.1 <a class="reference internal" href="#cenwaves"><span class="xref myst">LSFs from Various Central Wavelenths</span></a></p>
<p>- 3.2 <a class="reference internal" href="#lifetimes"><span class="xref myst">LSFs from Various Lifetime Positions</span></a></p>
<p><strong>4. <a class="reference internal" href="#combining"><span class="xref myst">Techniques for Combining Spectra with Different LSFs</span></a></strong></p>
<p>- 4.1 <a class="reference internal" href="#getdata"><span class="xref myst">Retrieve and Combine the Spectra</span></a></p>
<p>- 4.2 <a class="reference internal" href="#separate"><span class="xref myst">Fit each combination of grating, LSF, and CENWAVE separately</span></a></p>
<p>- 4.3 <a class="reference internal" href="#convolve"><span class="xref myst">Convolve the LP1 Spectrum to Match LP4</span></a></p>
<p>- 4.4 <a class="reference internal" href="#bespoke"><span class="xref myst">Construct a bespoke LSF for this spectral combination</span></a></p>
<p><a id = introduction></a></p>
</section>
<section id="introduction">
<h2>0. Introduction<a class="headerlink" href="#introduction" title="Link to this heading">#</a></h2>
<p>The <a class="reference external" href="https://archive.stsci.edu/missions-and-data/hst/hasp">Hubble Advanced Spectral Products (HASP)</a> program provides co-added spectra within individual observing programs that use the <a class="reference external" href="https://www.stsci.edu/hst/instrumentation/stis">Space Telescope Imaging Spectrograph (STIS)</a> and the <a class="reference external" href="https://www.stsci.edu/hst/instrumentation/cos">Cosmic Origins Spectrograph (COS)</a> instruments onboard the <a class="reference external" href="https://www.stsci.edu/hst">Hubble Space Telescope (HST)</a>. The <a class="reference external" href="https://archive.stsci.edu/missions-and-data/hsla">Hubble Spectroscopic Legacy Archive (HSLA)</a>, goes one step farther, combining data from multiple instruments and observing programs to create spectra with the highest possible signal-to-noise and wavelength range.</p>
<p>When analyzing any scientific measurement, it is important to consider all of the instrumental effects to which your data are subject.  In the case of imaging, point sources in the sky are broadened by the telescope and instrument optics.  In the case of spectroscopy, narrow absorption lines are broadened by the line-spread function (LSF; the shape imposed on an infinitely narrow line by the optics) of the spectrograph.  In most cases, the LSF of a spectrograph can be approximated by a Gaussian of known FHWM. For COS, the LSF is not a Gaussian; it has more power in the wings than a Gaussian of the same FWHM.  Ignoring this effect could lead one to under-estimate the flux in an emission line or the equivalent width of an absorption feature.  The COS LSF is described in <a class="reference external" href="https://hst-docs.stsci.edu/cosihb/chapter-3-description-and-performance-of-the-cos-optics/3-3-the-cos-line-spread-function#id-3.3TheCOSLineSpreadFunction-Section3.3.13.3.1Non-GaussianityoftheCOSLSF">Section 3.3.1 of the COS Instrument Handbook</a>.</p>
<p>A second effect comes into play with both HASP and HSLA: the LSFs of spectra taken in the blue modes (CENWAVES 1055, 1096, and 1222) are considerably broader than those of spectra with CENWAVE 1291 and higher.  For full wavelength coverage, observers are instructed to use both CENWAVE 1222 and CENWAVE 1291.  But in the region where the resulting spectra overlap (from about 1100 to 1350 A), both HASP and HSLA simply co-add the two spectra, resulting in a hybrid LSF that complicates the analysis.</p>
<p>A third effect:  Because the COS detector is susceptible to gain sag, the instrument is adjusted at regular intervals so that spectra fall on previously unilluminated regions of the detector, called lifetime positions (LPs).  Spectra taken at LP1 have the highest spectral resolution, while spectra taken at other LPs have successively lower resolution. The final product of the HSLA, a spectrum made by co-adding data from multiple observing programs, may contain data taken at multiple LPs, again resulting in a hybrid LSF.  These effects are illustrated in <a class="reference external" href="https://hst-docs.stsci.edu/cosihb/chapter-3-description-and-performance-of-the-cos-optics/3-3-the-cos-line-spread-function#id-3.3TheCOSLineSpreadFunction-Section3.3.23.3.2QuantifyingtheResolution">Figure 3.7 of the COS Instrument Handbook</a>.</p>
<p>In this notebook, we will compare the COS LSFs from multiple CENWAVEs and lifetime positions to better understand these effects.  Then we will consider three ways to deal with them.  The first is not to use the final HASP and HSLA products at all, but to create products that contain data from a single grating, LP, and CENWAVE and fit them separately.  The second is to combine these single-configuration products into a co-added spectrum, first smoothing the higher-resolution spectra to the resolution of the lowest-resolution spectrum.  The third approach is to use the HASP/HSLA final products, but to scale and combine the relevant LSFs to match your data.</p>
<p>By the way, the G130M and G160M gratings have different LSFs in the region of overlap, so everything in this notebook applies to the case of multiple gratings.  The difference is that neither HASP nor HSLA co-adds data from different instruments or gratings, so the final data products are immune to this effect.</p>
<section id="imports">
<h3>Imports<a class="headerlink" href="#imports" title="Link to this heading">#</a></h3>
<p>We will be using multiple libraries to retrieve and analyze data:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">astropy.units</span></code> to assign units to various quantities</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">astropy.convolution.convolve</span></code> to convolve functions with a Gaussian</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">astropy.io.ascii</span></code> and <code class="docutils literal notranslate"><span class="pre">fits</span></code> to work with ASCII and FITS files</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">astropy.visualization.quantity_support</span></code> to put units on our plots</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">astroquery.mast.Observations</span></code> to retrieve COS spectra from MAST</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">glob</span></code> to work with multiple files in our directories</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">matplotlib.pyplot</span></code> to plot spectra</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">numpy</span></code> to calculate various values</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">os</span></code> to interact with the operating system</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">pathlib.Path</span></code> to create a data directory</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">scipy.optimize.curve_fit</span></code> to fit a function to a spectrum</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">shutil</span></code> to perform directory and file operations</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">specutils.Spectrum1d</span></code> to create Spectrum1d objects</p></li>
</ul>
<p>We recommend creating a HASP-specific <code class="docutils literal notranslate"><span class="pre">conda</span></code> environment. You can check out our <a class="reference external" href="https://github.com/spacetelescope/hst_notebooks/tree/main/notebooks/HASP/Setup">Setup.ipynb</a> notebook to create such an environment.</p>
<p>Let’s import all of the packages that we will use in this notebook by running the next cell:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%</span><span class="k">matplotlib</span> inline

<span class="kn">import</span><span class="w"> </span><span class="nn">glob</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">os</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">shutil</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">urllib</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">astropy.convolution</span><span class="w"> </span><span class="kn">import</span> <span class="n">convolve</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">astropy.io</span><span class="w"> </span><span class="kn">import</span> <span class="n">ascii</span><span class="p">,</span> <span class="n">fits</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">astropy.visualization</span><span class="w"> </span><span class="kn">import</span> <span class="n">quantity_support</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">astroquery.mast</span><span class="w"> </span><span class="kn">import</span> <span class="n">Observations</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">matplotlib</span><span class="w"> </span><span class="kn">import</span> <span class="n">pyplot</span> <span class="k">as</span> <span class="n">plt</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pathlib</span><span class="w"> </span><span class="kn">import</span> <span class="n">Path</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">scipy.optimize</span><span class="w"> </span><span class="kn">import</span> <span class="n">curve_fit</span>

<span class="c1"># Specify plot parameters.</span>
<span class="n">quantity_support</span><span class="p">()</span>  <span class="c1"># to put units on the axes below </span>
<span class="n">matplotlib</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;figure.figsize&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mi">15</span><span class="p">,</span> <span class="mi">5</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<p><a id = lsfdownload></a></p>
</section>
</section>
<section id="download-the-cos-line-spread-functions">
<h2>1. Download the COS Line-Spread Functions<a class="headerlink" href="#download-the-cos-line-spread-functions" title="Link to this heading">#</a></h2>
<p>From the <a class="reference external" href="https://www.stsci.edu/hst/instrumentation/cos/performance/spectral-resolution">COS homepage</a>, you can find all the <a class="reference external" href="https://www.stsci.edu/hst/instrumentation/cos/performance/spectral-resolution">COS Line Spread Functions</a>.  They are all located in tables containing the various LSFs entitled “Tabulated Theoretical Line Spread Functions” for each individual lifetime position. We will use Python to create a directory to store the LSFs we need, and then download the following LSF files:</p>
<ul class="simple">
<li><p>The LSFs for grating G130M across all lifetime positions (1-5) for central wavelength 1291</p></li>
<li><p>The LSFs for grating G130M for LP2 and central wavelengths 1055, 1096, 1222, and 1327</p></li>
<li><p>The LSF for G130M for LP4 and central wavelength 1309</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Define the LSF directory to hold the files.</span>
<span class="n">lsf_dir</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="s2">&quot;./LSF/&quot;</span><span class="p">)</span>

<span class="c1"># If the directory doesn&#39;t exist, then create it.</span>
<span class="n">lsf_dir</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Create a function that downloads the LSF files we need based on grating, lifetime position, and cenwave. </span>

<span class="k">def</span><span class="w"> </span><span class="nf">fetch_files</span><span class="p">(</span><span class="n">grating</span><span class="p">,</span> <span class="n">lpPos</span><span class="p">,</span> <span class="n">cenwave</span><span class="p">):</span>
    <span class="c1"># Link to where all the files live</span>
    <span class="n">COS_site_rootname</span> <span class="o">=</span> <span class="p">(</span>
        <span class="s2">&quot;https://www.stsci.edu/files/live/sites/www/files/home/hst/instrumentation/cos/&quot;</span>
        <span class="s2">&quot;performance/spectral-resolution/_documents/&quot;</span><span class="p">)</span>
    
    <span class="n">LSF_file_name</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;aa_LSFTable_</span><span class="si">{</span><span class="n">grating</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">cenwave</span><span class="si">}</span><span class="s2">_LP</span><span class="si">{</span><span class="n">lpPos</span><span class="si">}</span><span class="s2">_cn.dat&quot;</span>
    
    <span class="n">LSF_file_webpath</span> <span class="o">=</span> <span class="n">COS_site_rootname</span> <span class="o">+</span> <span class="n">LSF_file_name</span>  <span class="c1"># Where to find file online</span>
    <span class="n">urllib</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">urlretrieve</span><span class="p">(</span>
        <span class="n">LSF_file_webpath</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">lsf_dir</span> <span class="o">/</span> <span class="n">LSF_file_name</span><span class="p">)</span>
    <span class="p">)</span>  <span class="c1"># Where to save file to locally</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Use this function to download the LSF files </span>
<span class="c1"># LSFs for grating G130M and central wavelength 1291, across all lifetime positions (1-5)</span>
<span class="n">fetch_files</span><span class="p">(</span><span class="s1">&#39;G130M&#39;</span><span class="p">,</span> <span class="s1">&#39;1&#39;</span><span class="p">,</span> <span class="s1">&#39;1291&#39;</span><span class="p">)</span>
<span class="n">fetch_files</span><span class="p">(</span><span class="s1">&#39;G130M&#39;</span><span class="p">,</span> <span class="s1">&#39;2&#39;</span><span class="p">,</span> <span class="s1">&#39;1291&#39;</span><span class="p">)</span>
<span class="n">fetch_files</span><span class="p">(</span><span class="s1">&#39;G130M&#39;</span><span class="p">,</span> <span class="s1">&#39;3&#39;</span><span class="p">,</span> <span class="s1">&#39;1291&#39;</span><span class="p">)</span>
<span class="n">fetch_files</span><span class="p">(</span><span class="s1">&#39;G130M&#39;</span><span class="p">,</span> <span class="s1">&#39;4&#39;</span><span class="p">,</span> <span class="s1">&#39;1291&#39;</span><span class="p">)</span>
<span class="n">fetch_files</span><span class="p">(</span><span class="s1">&#39;G130M&#39;</span><span class="p">,</span> <span class="s1">&#39;5&#39;</span><span class="p">,</span> <span class="s1">&#39;1291&#39;</span><span class="p">)</span>

<span class="c1"># LSFs for G130M LP2 central wavelengths 1055, 1096, 1222, and 1327</span>
<span class="n">fetch_files</span><span class="p">(</span><span class="s1">&#39;G130M&#39;</span><span class="p">,</span> <span class="s1">&#39;2&#39;</span><span class="p">,</span> <span class="s1">&#39;1055&#39;</span><span class="p">)</span>
<span class="n">fetch_files</span><span class="p">(</span><span class="s1">&#39;G130M&#39;</span><span class="p">,</span> <span class="s1">&#39;2&#39;</span><span class="p">,</span> <span class="s1">&#39;1096&#39;</span><span class="p">)</span>
<span class="n">fetch_files</span><span class="p">(</span><span class="s1">&#39;G130M&#39;</span><span class="p">,</span> <span class="s1">&#39;2&#39;</span><span class="p">,</span> <span class="s1">&#39;1222&#39;</span><span class="p">)</span>
<span class="n">fetch_files</span><span class="p">(</span><span class="s1">&#39;G130M&#39;</span><span class="p">,</span> <span class="s1">&#39;2&#39;</span><span class="p">,</span> <span class="s1">&#39;1327&#39;</span><span class="p">)</span>

<span class="c1"># LSFs for G130M LP1/LP4 central wavelength 1309</span>
<span class="n">fetch_files</span><span class="p">(</span><span class="s1">&#39;G130M&#39;</span><span class="p">,</span> <span class="s1">&#39;1&#39;</span><span class="p">,</span> <span class="s1">&#39;1309&#39;</span><span class="p">)</span>
<span class="n">fetch_files</span><span class="p">(</span><span class="s1">&#39;G130M&#39;</span><span class="p">,</span> <span class="s1">&#39;4&#39;</span><span class="p">,</span> <span class="s1">&#39;1309&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p><a id = definitions></a></p>
</section>
<section id="define-functions-for-later-use">
<h2>2. Define Functions for Later Use<a class="headerlink" href="#define-functions-for-later-use" title="Link to this heading">#</a></h2>
<p>Here we define a handful of functions that we will use later.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Function to compute emperical FWHM of a LSF</span>
<span class="k">def</span><span class="w"> </span><span class="nf">get_fwhm</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
    <span class="n">xprime</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">size</span> <span class="o">*</span> <span class="mf">10.</span><span class="p">)</span> <span class="o">/</span> <span class="mf">10.</span>
    <span class="n">yprime</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">interp</span><span class="p">(</span><span class="n">xprime</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
    <span class="n">center</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">yprime</span><span class="p">)</span>
    
    <span class="n">half</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">y</span><span class="p">)</span> <span class="o">/</span> <span class="mf">2.</span>
    <span class="n">diff</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">yprime</span> <span class="o">-</span> <span class="n">half</span><span class="p">)</span>
    <span class="n">x1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmin</span><span class="p">(</span><span class="n">diff</span><span class="p">[:</span><span class="n">center</span><span class="p">])</span>
    <span class="n">x2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmin</span><span class="p">(</span><span class="n">diff</span><span class="p">[</span><span class="n">center</span><span class="p">:])</span> <span class="o">+</span> <span class="n">center</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">x2</span> <span class="o">-</span> <span class="n">x1</span><span class="p">)</span><span class="o">/</span><span class="mi">10</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Function to compute a Gaussian given the value of sigma</span>
<span class="k">def</span><span class="w"> </span><span class="nf">get_gaussian</span><span class="p">(</span><span class="n">sigma</span><span class="p">):</span>
    <span class="n">length</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="mi">8</span> <span class="o">*</span> <span class="n">sigma</span><span class="p">)</span>
    <span class="c1"># Kernel length must be odd.</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">length</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">0</span><span class="p">):</span>
        <span class="n">length</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="n">xx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">length</span><span class="p">)</span>
    <span class="n">mu</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">length</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>
    <span class="n">x</span> <span class="o">=</span> <span class="p">(</span><span class="n">xx</span> <span class="o">-</span> <span class="n">mu</span><span class="p">)</span><span class="o">/</span><span class="n">sigma</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="mf">0.5</span> <span class="o">*</span> <span class="n">x</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Function to read an LSF file</span>
<span class="k">def</span><span class="w"> </span><span class="nf">get_lsf</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">wave</span><span class="p">):</span>
    <span class="n">table</span> <span class="o">=</span> <span class="n">ascii</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;basic&#39;</span><span class="p">)</span>
    <span class="n">lsf</span> <span class="o">=</span> <span class="n">table</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">wave</span><span class="p">)]</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">lsf</span><span class="o">.</span><span class="n">size</span><span class="p">)</span>

    <span class="n">fwhm</span> <span class="o">=</span> <span class="n">get_fwhm</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">lsf</span><span class="p">)</span>
    <span class="n">d130</span> <span class="o">=</span> <span class="mf">0.01</span>
    <span class="n">resolution</span> <span class="o">=</span> <span class="n">wave</span> <span class="o">/</span> <span class="n">fwhm</span> <span class="o">/</span> <span class="n">d130</span>

    <span class="k">return</span> <span class="n">lsf</span><span class="p">,</span> <span class="n">resolution</span><span class="p">,</span> <span class="n">fwhm</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Define an LSF object, which we will use when convolving an LSF with a Gaussian.</span>
<span class="k">class</span><span class="w"> </span><span class="nc">LSF</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lsf</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">add_lsf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">wave</span><span class="p">,</span> <span class="n">lsf</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">wave</span> <span class="o">=</span> <span class="n">wave</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lsf</span> <span class="o">=</span> <span class="n">lsf</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">my_func</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data_wave</span><span class="p">,</span> <span class="n">sigma</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This function convolves a line-spread function with a Gaussian of a given width (sigma).</span>
<span class="sd">        &quot;&quot;&quot;</span>     
        <span class="n">gauss</span> <span class="o">=</span> <span class="n">get_gaussian</span><span class="p">(</span><span class="n">sigma</span><span class="p">)</span>              <span class="c1"># Compute Gaussian in LP1 pixels.</span>
        <span class="n">a</span> <span class="o">=</span> <span class="n">convolve</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lsf</span><span class="p">,</span> <span class="n">gauss</span><span class="p">)</span>            <span class="c1"># Convolve LP1 LSF with Gaussian.</span>
        <span class="k">return</span> <span class="n">a</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>                       <span class="c1"># Normalize new LSF.</span>
</pre></div>
</div>
</div>
</div>
<p><a id = comparelsfs></a></p>
</section>
<section id="compare-lsfs-from-various-lifetime-positions-and-cenwaves">
<h2>3. Compare LSFs from Various Lifetime Positions and CENWAVEs<a class="headerlink" href="#compare-lsfs-from-various-lifetime-positions-and-cenwaves" title="Link to this heading">#</a></h2>
<p><a id = cenwaves></a></p>
<section id="lsfs-from-various-central-wavelenths">
<h3>3.1 LSFs from Various Central Wavelenths<a class="headerlink" href="#lsfs-from-various-central-wavelenths" title="Link to this heading">#</a></h3>
<p>First, let’s see how much the LSF changes from one CENWAVE to another.  We’ll start at 1200 A, then move to 1350 A.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Read LSF file for G130M, LP2, cenwave = 1222, lambda = 1194</span>

<span class="n">lsf_1055</span><span class="p">,</span> <span class="n">res_1055</span><span class="p">,</span> <span class="n">fwhm_1055</span> <span class="o">=</span> <span class="n">get_lsf</span><span class="p">(</span><span class="s1">&#39;LSF/aa_LSFTable_G130M_1055_LP2_cn.dat&#39;</span><span class="p">,</span> <span class="mi">1194</span><span class="p">)</span>

<span class="c1"># Read LSF file for G130M, LP2, cenwave = 1222, lambda = 1195</span>

<span class="n">lsf_1096</span><span class="p">,</span> <span class="n">res_1096</span><span class="p">,</span> <span class="n">fwhm_1096</span> <span class="o">=</span> <span class="n">get_lsf</span><span class="p">(</span><span class="s1">&#39;LSF/aa_LSFTable_G130M_1096_LP2_cn.dat&#39;</span><span class="p">,</span> <span class="mi">1195</span><span class="p">)</span>

<span class="c1"># Read LSF file for G130M, LP2, cenwave = 1222, lambda = 1197</span>

<span class="n">lsf_1222</span><span class="p">,</span> <span class="n">res_1222</span><span class="p">,</span> <span class="n">fwhm_1222</span> <span class="o">=</span> <span class="n">get_lsf</span><span class="p">(</span><span class="s1">&#39;LSF/aa_LSFTable_G130M_1222_LP2_cn.dat&#39;</span><span class="p">,</span> <span class="mi">1197</span><span class="p">)</span>

<span class="c1"># Read LSF file for G130M, LP2, cenwave = 1291, lambda = 1194</span>

<span class="n">lsf_1291</span><span class="p">,</span> <span class="n">res_1291</span><span class="p">,</span> <span class="n">fwhm_1291</span> <span class="o">=</span> <span class="n">get_lsf</span><span class="p">(</span><span class="s1">&#39;LSF/aa_LSFTable_G130M_1291_LP2_cn.dat&#39;</span><span class="p">,</span> <span class="mi">1194</span><span class="p">)</span>

<span class="c1"># Read LSF files for G130M, LP2, cenwave = 1327, lambda = 1197</span>

<span class="n">lsf_1327</span><span class="p">,</span> <span class="n">res_1327</span><span class="p">,</span> <span class="n">fwhm_1327</span> <span class="o">=</span> <span class="n">get_lsf</span><span class="p">(</span><span class="s1">&#39;LSF/aa_LSFTable_G130M_1327_LP2_cn.dat&#39;</span><span class="p">,</span> <span class="mi">1197</span><span class="p">)</span>

<span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">lsf_1291</span><span class="o">.</span><span class="n">size</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;CENWAVE Res  FWHM (pix)     &#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;1055   &#39;</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">res_1055</span><span class="p">),</span> <span class="n">fwhm_1055</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;1096   &#39;</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">res_1096</span><span class="p">),</span> <span class="n">fwhm_1096</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;1222   &#39;</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">res_1222</span><span class="p">),</span> <span class="n">fwhm_1222</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;1291   &#39;</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">res_1291</span><span class="p">),</span> <span class="n">fwhm_1291</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;1327   &#39;</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">res_1327</span><span class="p">),</span> <span class="n">fwhm_1327</span><span class="p">)</span>

<span class="n">f</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span> 
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">lsf_1055</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;1055&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">lsf_1096</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;1096&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">lsf_1222</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;1222&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">lsf_1291</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;1291&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">lsf_1327</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;1327&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;COS LSFs at 1200 Angstroms&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">([</span><span class="mi">120</span><span class="p">,</span> <span class="mi">200</span><span class="p">])</span>
</pre></div>
</div>
</div>
</div>
<p>1200 A represents the red end of the CENWAVE 1055 and 1096 spectra.  In this region, their LSFs are completely different from those of the bluer modes.  This matters because HASP and HSLA co-add spectra with all available CENWAVEs.  At wavelengths where the LSFs differ, spectral lines in the combined spectra could have unexpected shapes.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Read LSF file for G130M, LP2, cenwave = 1222, lambda = 1352</span>

<span class="n">lsf_1222</span><span class="p">,</span> <span class="n">res_1222</span><span class="p">,</span> <span class="n">fwhm_1222</span> <span class="o">=</span> <span class="n">get_lsf</span><span class="p">(</span><span class="s1">&#39;LSF/aa_LSFTable_G130M_1222_LP2_cn.dat&#39;</span><span class="p">,</span> <span class="mi">1352</span><span class="p">)</span>

<span class="c1"># Read LSF file for G130M, LP2, cenwave = 1291, lambda = 1350</span>

<span class="n">lsf_1291</span><span class="p">,</span> <span class="n">res_1291</span><span class="p">,</span> <span class="n">fwhm_1291</span> <span class="o">=</span> <span class="n">get_lsf</span><span class="p">(</span><span class="s1">&#39;LSF/aa_LSFTable_G130M_1291_LP2_cn.dat&#39;</span><span class="p">,</span> <span class="mi">1350</span><span class="p">)</span>

<span class="c1"># Read LSF files for G130M, LP2, cenwave = 1327, lambda = 1351</span>

<span class="n">lsf_1327</span><span class="p">,</span> <span class="n">res_1327</span><span class="p">,</span> <span class="n">fwhm_1327</span> <span class="o">=</span> <span class="n">get_lsf</span><span class="p">(</span><span class="s1">&#39;LSF/aa_LSFTable_G130M_1327_LP2_cn.dat&#39;</span><span class="p">,</span> <span class="mi">1351</span><span class="p">)</span>

<span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">lsf_1291</span><span class="o">.</span><span class="n">size</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;CENWAVE Res  FWHM (pix)     &#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;1222   &#39;</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">res_1222</span><span class="p">),</span> <span class="n">fwhm_1222</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;1291   &#39;</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">res_1291</span><span class="p">),</span> <span class="n">fwhm_1291</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;1327   &#39;</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">res_1327</span><span class="p">),</span> <span class="n">fwhm_1327</span><span class="p">)</span>

<span class="n">f</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span> 
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">lsf_1222</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;1222&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">lsf_1291</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;1291&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">lsf_1327</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;1327&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;COS LSFs at 1350 Angstroms&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">([</span><span class="mi">140</span><span class="p">,</span> <span class="mi">180</span><span class="p">])</span>
</pre></div>
</div>
</div>
</div>
<p>At 1350 A, we are at the red end of the CENWAVE 1222 spectrum.  Again, its LSF is much broader than those of the redder CENWAVEs.  If you need the highest possible spectral resolution, then you don’t want to co-add spectra taken in the blue modes (CENWAVE 1055, 1096, or 1222) with those taken in the standard modes (CENWAVE &gt;= 1291).</p>
<p>Which CENWAVEs contribute to the final HASP/HSLA spectrum?  Information about the CENWAVE is lost early in HASP processing.  It is not included in the HSLA metadata files.  The metadata files do list the minimum wavelength contributed by each grating/LP combination; values smaller than 1400 A indicate that at least one of the input spectra has CENWAVE &lt;= 1222.</p>
<p><a id = lifetimes></a></p>
</section>
<section id="lsfs-from-various-lifetime-positions">
<h3>3.2 LSFs from Various Lifetime Positions<a class="headerlink" href="#lsfs-from-various-lifetime-positions" title="Link to this heading">#</a></h3>
<p>The COS LSF varies with lifetime position as well as with CENWAVE.  To explore this effect, we read the LSFs for lifetime positions 1 through 5, compute their resolution and FWHM, and plot them.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Read LSF files for G130M, cenwave = 1291, lambda = 1300</span>

<span class="n">lsf_lp1</span><span class="p">,</span> <span class="n">res_lp1</span><span class="p">,</span> <span class="n">fwhm_lp1</span> <span class="o">=</span> <span class="n">get_lsf</span><span class="p">(</span><span class="s1">&#39;LSF/aa_LSFTable_G130M_1291_LP1_cn.dat&#39;</span><span class="p">,</span> <span class="mi">1300</span><span class="p">)</span>
<span class="n">lsf_lp2</span><span class="p">,</span> <span class="n">res_lp2</span><span class="p">,</span> <span class="n">fwhm_lp2</span> <span class="o">=</span> <span class="n">get_lsf</span><span class="p">(</span><span class="s1">&#39;LSF/aa_LSFTable_G130M_1291_LP2_cn.dat&#39;</span><span class="p">,</span> <span class="mi">1300</span><span class="p">)</span>
<span class="n">lsf_lp3</span><span class="p">,</span> <span class="n">res_lp3</span><span class="p">,</span> <span class="n">fwhm_lp3</span> <span class="o">=</span> <span class="n">get_lsf</span><span class="p">(</span><span class="s1">&#39;LSF/aa_LSFTable_G130M_1291_LP3_cn.dat&#39;</span><span class="p">,</span> <span class="mi">1300</span><span class="p">)</span>
<span class="n">lsf_lp4</span><span class="p">,</span> <span class="n">res_lp4</span><span class="p">,</span> <span class="n">fwhm_lp4</span> <span class="o">=</span> <span class="n">get_lsf</span><span class="p">(</span><span class="s1">&#39;LSF/aa_LSFTable_G130M_1291_LP4_cn.dat&#39;</span><span class="p">,</span> <span class="mi">1300</span><span class="p">)</span>
<span class="n">lsf_lp5</span><span class="p">,</span> <span class="n">res_lp5</span><span class="p">,</span> <span class="n">fwhm_lp5</span> <span class="o">=</span> <span class="n">get_lsf</span><span class="p">(</span><span class="s1">&#39;LSF/aa_LSFTable_G130M_1291_LP5_cn.dat&#39;</span><span class="p">,</span> <span class="mi">1300</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;LP  Res  FWHM (pixels)&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;1  &#39;</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">res_lp1</span><span class="p">),</span> <span class="n">fwhm_lp1</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;2  &#39;</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">res_lp2</span><span class="p">),</span> <span class="n">fwhm_lp2</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;3  &#39;</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">res_lp3</span><span class="p">),</span> <span class="n">fwhm_lp3</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;4  &#39;</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">res_lp4</span><span class="p">),</span> <span class="n">fwhm_lp4</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;5  &#39;</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">res_lp5</span><span class="p">),</span> <span class="n">fwhm_lp5</span><span class="p">)</span>

<span class="n">f</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span> 
<span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">lsf_lp1</span><span class="o">.</span><span class="n">size</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">lsf_lp1</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;LP1&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">lsf_lp2</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;LP2&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">lsf_lp3</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;LP3&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">lsf_lp4</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;LP4&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">lsf_lp5</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;LP5&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;COS LSFs at 1300 Angstroms&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">([</span><span class="mi">140</span><span class="p">,</span> <span class="mi">180</span><span class="p">])</span>
</pre></div>
</div>
</div>
</div>
<p>We see that there are three families of LSF curves, corresponding to their distance from LP1.  LP1 itself has the highest resolution.  LP2 and LP3, which lie immediately above and below LP1 on the COS detector, have slightly lower resolution.  LP4 and LP5, which are still farther from LP1, have the lowest resolution.</p>
<p>While the peaks of these curves shift to the left with increasing LP number, all five have the same mean value.  This is because, as the curves broaden, more of the flux moves into the wings on the right-hand side of the distribution.</p>
<p>If your science requires that you understand the subtleties of the instrumental line-spread function, then you should proceed carefully when combining data taken at multiple lifetime positions.  We consider two techniques for doing this below.</p>
<p><a id = combining></a></p>
</section>
</section>
<section id="techniques-for-combining-spectra-with-different-lsfs">
<h2>4. Techniques for Combining Spectra with Different LSFs<a class="headerlink" href="#techniques-for-combining-spectra-with-different-lsfs" title="Link to this heading">#</a></h2>
<p><a id = getdata></a></p>
<section id="retrieve-and-combine-the-spectra">
<h3>4.1 Retrieve and Combine the Spectra<a class="headerlink" href="#retrieve-and-combine-the-spectra" title="Link to this heading">#</a></h3>
<p>The star WD0308-565 (WG 7) is a calibration standard.  Let’s use spectra taken at two lifetime positions.  For maximum contrast, we will use LP1 and LP4.<br />
We begin by setting up our directory structure and querying the MAST database for all COS spectra of the star. This will give us a list of all observations for the program.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Define the data-download directory.</span>
<span class="n">cos_data_dir</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="s2">&quot;./cos_data/&quot;</span><span class="p">)</span>
<span class="c1"># Define the products directory to hold the output.</span>
<span class="n">cos_products_dir</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="s2">&quot;./cos_products/&quot;</span><span class="p">)</span>

<span class="c1"># If the directories doesn&#39;t exist, then create them.</span>
<span class="n">cos_data_dir</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">cos_products_dir</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Conduct the query</span>
<span class="n">wg7_products</span> <span class="o">=</span> <span class="n">Observations</span><span class="o">.</span><span class="n">get_product_list</span><span class="p">(</span>
    <span class="n">Observations</span><span class="o">.</span><span class="n">query_criteria</span><span class="p">(</span>
        <span class="n">instrument_name</span><span class="o">=</span><span class="s1">&#39;COS&#39;</span><span class="p">,</span>
        <span class="n">target_name</span><span class="o">=</span><span class="s1">&#39;WD*0308-565&#39;</span><span class="p">,</span>
        <span class="n">dataproduct_type</span><span class="o">=</span><span class="s2">&quot;SPECTRUM&quot;</span>
    <span class="p">)</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>This query returns all available data, but we want only the x1d files of spectra taken with the G130M grating.  (This takes a few minutes, so be patient.)</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">Observations</span><span class="o">.</span><span class="n">download_products</span><span class="p">(</span>
    <span class="n">wg7_products</span><span class="p">,</span>
    <span class="n">download_dir</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">cos_data_dir</span><span class="p">),</span>
    <span class="n">filters</span><span class="o">=</span><span class="s1">&#39;G130M&#39;</span><span class="p">,</span>
    <span class="n">productSubGroupDescription</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;X1D&quot;</span><span class="p">]</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>When we download data using astroquery, it creates a directory called mastDownload/HST. Each dataset goes into a separate subfolder within that directory.  Before running the combination script, we must move all of the x1d files into a single directory.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># The path to all obs_id folders</span>
<span class="n">mast_path</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">cos_data_dir</span><span class="si">}</span><span class="s2">/mastDownload/HST/&quot;</span>

<span class="c1"># Check if mastDownload exists</span>
<span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">mast_path</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Directory </span><span class="si">{</span><span class="n">mast_path</span><span class="si">}</span><span class="s2"> doesn&#39;t exist.&quot;</span><span class="p">)</span>

<span class="c1"># Getting a list of all obs_id folders. Each folder contains the FITS files</span>
<span class="n">obs_id_dirs</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">mast_path</span><span class="p">)</span>

<span class="c1"># Iterating through sub-folders to change the path of each FITS file</span>
<span class="k">for</span> <span class="n">obs_id</span> <span class="ow">in</span> <span class="n">obs_id_dirs</span><span class="p">:</span>
    <span class="c1"># This is the path to each obs_id folder</span>
    <span class="n">obs_id_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">mast_path</span><span class="p">,</span> <span class="n">obs_id</span><span class="p">)</span>

    <span class="c1"># Getting list of FITS files in /mastDownload/HST/&lt;obs_id&gt; folder</span>
    <span class="n">cos_files</span> <span class="o">=</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="n">obs_id_path</span> <span class="o">+</span> <span class="s2">&quot;/*fits&quot;</span><span class="p">)</span>

    <span class="c1"># Iterating through each of these files to change their path individually</span>
    <span class="c1"># We will be moving them to /cos_data</span>
    <span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">cos_files</span><span class="p">:</span>
        <span class="n">file_path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>
        <span class="n">new_path</span> <span class="o">=</span> <span class="n">cos_data_dir</span> <span class="o">/</span> <span class="n">file_path</span><span class="o">.</span><span class="n">name</span>
        <span class="n">shutil</span><span class="o">.</span><span class="n">move</span><span class="p">(</span><span class="n">file</span><span class="p">,</span> <span class="n">new_path</span><span class="p">)</span>

<span class="c1"># Now we can remove the mastDownload directory</span>
<span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">mast_path</span><span class="p">):</span>
    <span class="n">shutil</span><span class="o">.</span><span class="n">rmtree</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">cos_data_dir</span><span class="si">}</span><span class="s2">/mastDownload/&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>We want only the files taken at lifetime positions 1 and 4 and with CENWAVE &gt; 1250, so delete everything else.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">cos_files</span> <span class="o">=</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="s1">&#39;./cos_data/*fits&#39;</span><span class="p">)</span>

<span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">cos_files</span><span class="p">:</span>
    <span class="n">hdr</span> <span class="o">=</span> <span class="n">fits</span><span class="o">.</span><span class="n">getheader</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>
    <span class="n">cenwave</span> <span class="o">=</span> <span class="n">hdr</span><span class="p">[</span><span class="s1">&#39;CENWAVE&#39;</span><span class="p">]</span>
    <span class="n">life_adj</span> <span class="o">=</span> <span class="n">hdr</span><span class="p">[</span><span class="s1">&#39;LIFE_ADJ&#39;</span><span class="p">]</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">cenwave</span> <span class="o">&lt;</span> <span class="mi">1250</span><span class="p">):</span>
        <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>
        <span class="k">continue</span>
        
    <span class="k">if</span> <span class="ow">not</span> <span class="p">((</span><span class="n">life_adj</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">life_adj</span> <span class="o">==</span> <span class="mi">4</span><span class="p">)):</span>
        <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Now that we’ve retrieved and filtered the spectra, we can run the co-add script.</p>
<p>In a terminal window, execute the following command (or run the cell below).</p>
<p><code class="docutils literal notranslate"><span class="pre">swrapper</span> <span class="pre">-i</span> <span class="pre">cos_data</span> <span class="pre">-o</span> <span class="pre">cos_products</span> <span class="pre">-x</span></code></p>
<p>The -i parameter is the input directory (i.e, where the FITS files are located), while -o indicates the directory that will contain the newly created co-added products.  -x tells the program to keep the intermediate products.</p>
<p>Make sure that you are in the hasp-env conda environment that we created at the beginning of the notebook.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">!</span><span class="w"> </span>swrapper<span class="w"> </span>-i<span class="w"> </span>cos_data<span class="w"> </span>-o<span class="w"> </span>cos_products<span class="w"> </span>-x
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Read the combined spectra for each lifetime position.</span>

<span class="n">tbdata</span> <span class="o">=</span> <span class="n">fits</span><span class="o">.</span><span class="n">getdata</span><span class="p">(</span><span class="s1">&#39;cos_products/hst_cos_cos-data_g130m-lp01_cspec.fits&#39;</span><span class="p">)</span>
<span class="n">lp1_wave</span> <span class="o">=</span> <span class="n">tbdata</span><span class="p">[</span><span class="s1">&#39;wavelength&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
<span class="n">lp1_flux</span> <span class="o">=</span> <span class="n">tbdata</span><span class="p">[</span><span class="s1">&#39;flux&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
<span class="n">lp1_exp</span> <span class="o">=</span> <span class="n">tbdata</span><span class="p">[</span><span class="s1">&#39;eff_exptime&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>

<span class="n">tbdata</span> <span class="o">=</span> <span class="n">fits</span><span class="o">.</span><span class="n">getdata</span><span class="p">(</span><span class="s1">&#39;cos_products/hst_cos_cos-data_g130m-lp04_cspec.fits&#39;</span><span class="p">)</span>
<span class="n">lp4_wave</span> <span class="o">=</span> <span class="n">tbdata</span><span class="p">[</span><span class="s1">&#39;wavelength&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
<span class="n">lp4_flux</span> <span class="o">=</span> <span class="n">tbdata</span><span class="p">[</span><span class="s1">&#39;flux&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
<span class="n">lp4_exp</span> <span class="o">=</span> <span class="n">tbdata</span><span class="p">[</span><span class="s1">&#39;eff_exptime&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Plot the spectra.</span>

<span class="n">f</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">lp1_wave</span><span class="p">,</span> <span class="n">lp1_flux</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;LP1&#39;</span><span class="p">)</span> 
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">lp4_wave</span><span class="p">,</span> <span class="n">lp4_flux</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;LP4&#39;</span><span class="p">)</span> 
<span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="mi">1333</span><span class="p">,</span> <span class="mi">1338</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mf">3e-13</span><span class="p">])</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Wavelength ($</span><span class="se">\\</span><span class="s1">mathrm{</span><span class="se">\\</span><span class="s1">AA}$)&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Flux (erg cm$^{-2}$ s$^{-1}$ $</span><span class="se">\\</span><span class="s1">mathrm{</span><span class="se">\\</span><span class="s1">AA}^{-1}$)&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p><a id = separate></a></p>
</section>
<section id="fit-each-combination-of-grating-lsf-and-cenwave-separately">
<h3>4.2 Fit each combination of grating, LSF, and CENWAVE separately<a class="headerlink" href="#fit-each-combination-of-grating-lsf-and-cenwave-separately" title="Link to this heading">#</a></h3>
<p>When dealing with spectra obtained using multiple instrument configurations, the most accurate results are produced, not by summing the spectra to maximize the S/N ratio, but by fitting each spectrum separately, using the LSF appropriate for that configuration.  In this example, we could either fit our models to the LP1 and LP4 spectra separately and average the results or tweak our code to fit the two spectra simultaneously.  In either case, we would use the LSF for CENWAVE 1339 (the average CENWAVE for the red modes) and the appropriate lifetime position.</p>
<p><a id = convolve></a></p>
</section>
<section id="convolve-the-lp1-spectrum-to-match-lp4">
<h3>4.3 Convolve the LP1 Spectrum to Match LP4<a class="headerlink" href="#convolve-the-lp1-spectrum-to-match-lp4" title="Link to this heading">#</a></h3>
<p>Another approach is to reduce the resolution of the LP1 spectrum to match that of the LP4 spectrum.  We use the LSFs of the two spectra to derive a Gaussian that converts the LSF for LP1 into that for LP2, then convolve the LP1 spectrum with this Gaussian.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># We are interested in lines near 1335 A, so let&#39;s read the corresponding LSFs.</span>

<span class="n">lsf_lp1</span><span class="p">,</span> <span class="n">res_lp1</span><span class="p">,</span> <span class="n">fwhm_lp1</span> <span class="o">=</span> <span class="n">get_lsf</span><span class="p">(</span><span class="s1">&#39;LSF/aa_LSFTable_G130M_1309_LP1_cn.dat&#39;</span><span class="p">,</span> <span class="mi">1333</span><span class="p">)</span>
<span class="n">lsf_lp4</span><span class="p">,</span> <span class="n">res_lp4</span><span class="p">,</span> <span class="n">fwhm_lp4</span> <span class="o">=</span> <span class="n">get_lsf</span><span class="p">(</span><span class="s1">&#39;LSF/aa_LSFTable_G130M_1309_LP4_cn.dat&#39;</span><span class="p">,</span> <span class="mi">1333</span><span class="p">)</span>
<span class="n">lsf_wave</span> <span class="o">=</span> <span class="mf">0.01</span> <span class="o">*</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">321</span><span class="p">)</span> <span class="o">-</span> <span class="mi">160</span><span class="p">)</span>

<span class="n">f</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">lsf_wave</span><span class="p">,</span> <span class="n">lsf_lp1</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;LP1&#39;</span><span class="p">)</span> 
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">lsf_wave</span><span class="p">,</span> <span class="n">lsf_lp4</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;LP4&#39;</span><span class="p">)</span> 
<span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="o">-</span><span class="mf">0.3</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Construct an LSF object to hold the LP1 LSF,  Then find the Gaussian that, </span>
<span class="c1"># when convolved with the LP1 LSF, best reproduces LP4.</span>

<span class="n">s</span> <span class="o">=</span> <span class="n">LSF</span><span class="p">()</span>
<span class="n">s</span><span class="o">.</span><span class="n">add_lsf</span><span class="p">(</span><span class="n">lsf_wave</span><span class="p">,</span> <span class="n">lsf_lp1</span><span class="p">)</span>

<span class="n">p0</span> <span class="o">=</span> <span class="p">[</span><span class="mf">1.</span><span class="p">]</span>
<span class="n">popt</span><span class="p">,</span> <span class="n">pcov</span> <span class="o">=</span> <span class="n">curve_fit</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">my_func</span><span class="p">,</span> <span class="n">lsf_wave</span><span class="p">,</span> <span class="n">lsf_lp4</span><span class="p">,</span> <span class="n">p0</span><span class="o">=</span><span class="n">p0</span><span class="p">)</span>
<span class="n">sigma</span> <span class="o">=</span> <span class="n">popt</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">convolution</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">my_func</span><span class="p">(</span><span class="n">lsf_wave</span><span class="p">,</span> <span class="n">sigma</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;sigma = &#39;</span><span class="p">,</span> <span class="n">sigma</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># In this plot, the curve labeled &quot;Convolution&quot; is the LP1 LSF convolved with a Gaussian to reproduce the LP4 LSF.</span>

<span class="n">f</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">lsf_wave</span><span class="p">,</span> <span class="n">lsf_lp1</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;LP1&#39;</span><span class="p">)</span> 
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">lsf_wave</span><span class="p">,</span> <span class="n">lsf_lp4</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;LP4&#39;</span><span class="p">)</span> 
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">lsf_wave</span><span class="p">,</span> <span class="n">convolution</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Convolution&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Wavelength ($</span><span class="se">\\</span><span class="s1">mathrm{</span><span class="se">\\</span><span class="s1">AA}$)&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="o">-</span><span class="mf">0.3</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Plot the residuals.</span>

<span class="n">res</span> <span class="o">=</span> <span class="n">lsf_lp4</span> <span class="o">-</span> <span class="n">convolution</span>

<span class="n">f</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span> 
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">lsf_wave</span><span class="p">,</span> <span class="n">res</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">([</span><span class="o">-</span><span class="mf">0.3</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">])</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Wavelength ($</span><span class="se">\\</span><span class="s1">mathrm{</span><span class="se">\\</span><span class="s1">AA}$)&#39;</span><span class="p">)</span>
<span class="n">r1</span> <span class="o">=</span> <span class="n">res</span>

<span class="c1"># The largest deviation is about 8%.</span>
<span class="c1"># It may be possible to devise a kernel that does a better job, but this is fine for now.</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Now convolve the LP1 spectrum with our best-fit Gaussian.</span>
   
<span class="n">gauss</span> <span class="o">=</span> <span class="n">get_gaussian</span><span class="p">(</span><span class="n">sigma</span><span class="p">)</span>
<span class="n">out</span> <span class="o">=</span> <span class="n">convolve</span><span class="p">(</span><span class="n">lp1_flux</span><span class="p">,</span> <span class="n">gauss</span><span class="p">)</span>

<span class="c1"># Plot the smoothed LP1 spectrum and the LP4 spectrum.</span>

<span class="n">f</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span> 
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">lp1_wave</span><span class="p">,</span> <span class="n">out</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Smoothed LP1&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">lp4_wave</span><span class="p">,</span> <span class="n">lp4_flux</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;LP4&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="mi">1333</span><span class="p">,</span> <span class="mi">1338</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mf">3e-13</span><span class="p">])</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Flux ($10^{-13}$ erg cm$^{-2}$ s$^{-1}$ $</span><span class="se">\\</span><span class="s1">mathrm{</span><span class="se">\\</span><span class="s1">AA}^{-1}$)&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Wavelength ($</span><span class="se">\\</span><span class="s1">mathrm{</span><span class="se">\\</span><span class="s1">AA}$)&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>The good thing about this approach is that, in the region of overlap, the tabulated LP4 LSF functions can be used without modification.  The bad thing is that convolution by a Gaussian this broad smooths the data to an unacceptable degree.  Also, when the data are smoothed, the pixel values are no longer independent, and the errors are correlated.  Given these problems, this approach is not recommended.</p>
<p><a id = bespoke></a></p>
</section>
<section id="construct-a-bespoke-lsf-for-this-spectral-combination">
<h3>4.4 Construct a bespoke LSF for this spectral combination<a class="headerlink" href="#construct-a-bespoke-lsf-for-this-spectral-combination" title="Link to this heading">#</a></h3>
<p>The third option is to sum the two spectra and construct a new LSF to match.  We already have the summed spectrum.  It is the final product of the coadd script.<br />
Note that this spectrum contains only LP1 and LP4 data taken in the standard modes (CENWAVE &gt; 1250 A).  A spectrum retrieved from MAST would contain data from all lifetime positions and central wavelengths.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">tbdata</span> <span class="o">=</span> <span class="n">fits</span><span class="o">.</span><span class="n">getdata</span><span class="p">(</span><span class="s1">&#39;cos_products/hst_cos-data_aspec.fits&#39;</span><span class="p">)</span>
<span class="n">combo_wave</span> <span class="o">=</span> <span class="n">tbdata</span><span class="p">[</span><span class="s1">&#39;wavelength&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
<span class="n">combo_flux</span> <span class="o">=</span> <span class="n">tbdata</span><span class="p">[</span><span class="s1">&#39;flux&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Determine the exposure times for each lifetime position.</span>

<span class="n">lp1_exptime</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">lp1_exp</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">((</span><span class="n">lp1_wave</span> <span class="o">&gt;</span> <span class="mi">1333</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">lp1_wave</span> <span class="o">&lt;</span> <span class="mi">1338</span><span class="p">))])</span>
<span class="n">lp4_exptime</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">lp4_exp</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">((</span><span class="n">lp4_wave</span> <span class="o">&gt;</span> <span class="mi">1333</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">lp4_wave</span> <span class="o">&lt;</span> <span class="mi">1338</span><span class="p">))])</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;LP1 exposure time:&#39;</span><span class="p">,</span> <span class="n">lp1_exptime</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;LP4 exposure time:&#39;</span><span class="p">,</span> <span class="n">lp4_exptime</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Plot the individual and combined spectra.</span>

<span class="n">f</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>  
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">combo_wave</span><span class="p">,</span> <span class="n">combo_flux</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Combo&#39;</span><span class="p">)</span> 
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">lp1_wave</span><span class="p">,</span> <span class="n">lp1_flux</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;LP1&#39;</span><span class="p">)</span> 
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">lp4_wave</span><span class="p">,</span> <span class="n">lp4_flux</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;LP4&#39;</span><span class="p">)</span> 
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="mi">1333</span><span class="p">,</span> <span class="mi">1338</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mf">3e-13</span><span class="p">])</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Flux ($10^{-13}$ erg cm$^{-2}$ s$^{-1}$ $</span><span class="se">\\</span><span class="s1">mathrm{</span><span class="se">\\</span><span class="s1">AA}^{-1}$)&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Wavelength ($</span><span class="se">\\</span><span class="s1">mathrm{</span><span class="se">\\</span><span class="s1">AA}$)&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<p>In this case, the exposure time of the LP4 spectrum is four times that of the LP1 spectrum, so the combined spectrum looks a lot like the (lower-resolution) LP4 spectrum, but you get the idea.</p>
<p>This approach maintains the full resolution of the LP1 spectrum and the statistical independence of each pixel.  To construct an LSF for the combined spectrum, we scale and combine the LSFs, weighting by the exposure time.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">lsf_combo</span> <span class="o">=</span> <span class="p">(</span><span class="n">lsf_lp1</span> <span class="o">*</span> <span class="n">lp1_exptime</span> <span class="o">+</span> <span class="n">lsf_lp4</span> <span class="o">*</span> <span class="n">lp4_exptime</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">lp1_exptime</span> <span class="o">+</span> <span class="n">lp4_exptime</span><span class="p">)</span>

<span class="n">f</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span> 
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">lsf_wave</span><span class="p">,</span> <span class="n">lsf_lp1</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;LP1&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">lsf_wave</span><span class="p">,</span> <span class="n">lsf_lp4</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;LP4&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">lsf_wave</span><span class="p">,</span> <span class="n">lsf_combo</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Combo&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">([</span><span class="o">-</span><span class="mf">0.3</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">])</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Wavelength ($</span><span class="se">\\</span><span class="s1">mathrm{</span><span class="se">\\</span><span class="s1">AA}$)&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>If you have a synthetic spectrum, you can convolve it with the combined LSF to reproduce the features in the combined spectrum.  Of course, this LSF is valid only for the region around 1335 A.  You must construct separate LSFs for each spectral feature.</p>
</section>
</section>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="congrats-on-completing-the-notebook">
<h1>Congrats on completing the notebook!<a class="headerlink" href="#congrats-on-completing-the-notebook" title="Link to this heading">#</a></h1>
<section id="there-are-more-tutorial-notebooks-in-this-notebooks-repo-check-them-out">
<h2>There are more tutorial notebooks in <a class="reference external" href="https://github.com/spacetelescope/hst_notebooks/tree/main/notebooks/HASP">this notebooks repo</a>.  Check them out!<a class="headerlink" href="#there-are-more-tutorial-notebooks-in-this-notebooks-repo-check-them-out" title="Link to this heading">#</a></h2>
</section>
<section id="about-this-notebook">
<h2>About this Notebook<a class="headerlink" href="#about-this-notebook" title="Link to this heading">#</a></h2>
<p><strong>Authors:</strong> Van Dixon (dixon&#64;stsci.edu)</p>
<p><strong>Editor:</strong> Anna Payne (apayne&#64;stsci.edu</p>
<p><strong>Updated on:</strong> May 2025</p>
<p><em>This tutorial was generated to be in compliance with the <a class="reference external" href="https://github.com/spacetelescope/style-guides">STScI style guides</a> and would like to cite the <a class="reference external" href="https://github.com/spacetelescope/style-guides/blob/master/templates/example_notebook.ipynb">Jupyter guide</a> in particular.</em></p>
</section>
<section id="citations">
<h2>Citations<a class="headerlink" href="#citations" title="Link to this heading">#</a></h2>
<p>If you use <code class="docutils literal notranslate"><span class="pre">astropy</span></code>, <code class="docutils literal notranslate"><span class="pre">astroquery</span></code>, <code class="docutils literal notranslate"><span class="pre">numpy</span></code>, or <code class="docutils literal notranslate"><span class="pre">matplotlib</span></code>, for published research, please cite the authors. Follow these links for more information about citations:</p>
<ul class="simple">
<li><p><a class="reference external" href="https://docs.astropy.org/en/stable/index.html">Citing <code class="docutils literal notranslate"><span class="pre">astropy</span></code></a></p></li>
<li><p><a class="reference external" href="https://astroquery.readthedocs.io/en/latest/">Citing <code class="docutils literal notranslate"><span class="pre">astroquery</span></code></a></p></li>
<li><p><a class="reference external" href="https://matplotlib.org/stable/users/project/citing.html">Citing <code class="docutils literal notranslate"><span class="pre">matplotlib</span></code></a></p></li>
<li><p><a class="reference external" href="https://numpy.org/citing-numpy/">Citing <code class="docutils literal notranslate"><span class="pre">numpy</span></code></a></p></li>
</ul>
<a class="reference internal image-reference" href="https://raw.githubusercontent.com/spacetelescope/notebooks/master/assets/stsci_pri_combo_mark_horizonal_white_bkgd.png"><img alt="Space Telescope Logo" src="https://raw.githubusercontent.com/spacetelescope/notebooks/master/assets/stsci_pri_combo_mark_horizonal_white_bkgd.png" style="width: 200px;" />
</a>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "spacetelescope/hst_notebooks",
            ref: "main",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./notebooks/HASP/COSLifetimePositions"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="../WavelengthAdjustment/WavelengthAdjustment.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Wavelength Adjustments for Running the Hubble Advanced Spectral Products (HASP) Script</p>
      </div>
    </a>
    <a class="right-next"
       href="../../NICMOS/nicmos_unit_conversion/nicmos_unit_conversion.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Programmatic Replacements for NICMOS Units Conversion Form</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#">Combining COS Data from Multiple Lifetime Positions and Central Wavelengths</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#in-this-notebook-we-will-explore-the-implications-of-combining-cos-data-taken-at-different-lifetime-positions-and-central-wavelengths"><span style="font-weight:normal">In this notebook, we will explore the implications of combining COS data taken at different lifetime positions and central wavelengths.</span></a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#learning-goals">Learning Goals:</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#table-of-contents">Table of Contents</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#introduction">0. Introduction</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#imports">Imports</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#download-the-cos-line-spread-functions">1. Download the COS Line-Spread Functions</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#define-functions-for-later-use">2. Define Functions for Later Use</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#compare-lsfs-from-various-lifetime-positions-and-cenwaves">3. Compare LSFs from Various Lifetime Positions and CENWAVEs</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#lsfs-from-various-central-wavelenths">3.1 LSFs from Various Central Wavelenths</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#lsfs-from-various-lifetime-positions">3.2 LSFs from Various Lifetime Positions</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#techniques-for-combining-spectra-with-different-lsfs">4. Techniques for Combining Spectra with Different LSFs</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#retrieve-and-combine-the-spectra">4.1 Retrieve and Combine the Spectra</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#fit-each-combination-of-grating-lsf-and-cenwave-separately">4.2 Fit each combination of grating, LSF, and CENWAVE separately</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#convolve-the-lp1-spectrum-to-match-lp4">4.3 Convolve the LP1 Spectrum to Match LP4</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#construct-a-bespoke-lsf-for-this-spectral-combination">4.4 Construct a bespoke LSF for this spectral combination</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#congrats-on-completing-the-notebook">Congrats on completing the notebook!</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#there-are-more-tutorial-notebooks-in-this-notebooks-repo-check-them-out">There are more tutorial notebooks in this notebooks repo.  Check them out!</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#about-this-notebook">About this Notebook</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#citations">Citations</a></li>
</ul>
</li>
</ul>

  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By STScI
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2022-2024.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../../../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b"></script>
<script src="../../../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>